<link rel="import" href="../core9-filedrop/core9-filedrop.html">

<dom-module id="core9-filemanager">
<link rel="stylesheet" href="core9-filemanager.css">
<link href="../../../bower_components/footable/css/footable.core.min.css" rel="stylesheet" type="text/css" />
<link href="../../../bower_components/footable/css/footable.metro.min.css" rel="stylesheet" type="text/css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script> <script
	src="../../../bower_components/footable/dist/footable.all.min.js" type="text/javascript"
></script> <script src="../../../bower_components/footable/dist/footable.filter.min.js" type="text/javascript"></script>
<style>
:host {
	display: block;
	border: 0px solid grey;
	height: 100%;
	width: 96%;
}

core9-filedrop, core9-filedrop a {
	width: calc(100%);
	display: block;
	padding: 1em;
	margin: 1em;
	min-height: 1em;
	font-size: 1em;
	text-align: center;
	color: rgb(170, 170, 170);
	border: 1px solid black;
	border: 1px solid #ccc;
	border-radius: 3px;
	background-color: #fff;
	margin-left: 0px;
}
</style>
<template>




<div>



	<!-- Using Custom Elements -->
	<core9-filedrop> </core9-filedrop>


	<div class="input-field col s5">
		<input id="filter" type="text" /> <label>Search:</label>
	</div>
	<div class="input-field col s5">
		<select id="filterstatus" class="filter-status">
			<option></option>
			<option value="active">Active</option>
			<option value="disabled">Disabled</option>
			<option value="suspended">Suspended</option>
		</select> <label>Status:</label>
	</div>
	<script>
$(document).ready(function() {
    $('select').material_select();
  });
</script>


  <table id="table2" class="table" data-filter="#filter" data-filter-minimum="3" data-filter-timeout="500"
    data-filter-text-only="true" data-page-size="5"
  >
    <thead>
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th data-hide="phone,tablet">Job Title</th>
        <th data-hide="phone,tablet">DOB</th>
        <th data-hide="phone">Status</th>
        <th data-hide="phone">Delete</th>
      </tr>
    </thead>
    <tbody>
    <template is="dom-repeat" items="{{checks}}">
          <tr>
        <td>{{item.first}}</td>
        <td><a href="#">{{item.last}}</a></td>
        <td>Traffic Court Referee</td>
        <td data-value="78025368997">22 Jun 1972</td>
        <td data-value="1"><span class="status-metro status-active" title="Active">Active</span></td>
        <td><a class="row-delete" href="#"><span class="glyphicon glyphicon-remove">x</span></a></td>
      </tr>
      </template>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="6">
          <div class="pagination pagination-centered"></div>
        </td>
      </tr>
    </tfoot>
  </table>


	<content></content>
</div>
</template> </dom-module>

<script type="text/javascript">
var forceRedraw = function(element){

    if (!element) { return; }

    var n = document.createTextNode(' ');
    var disp = element.style.display;  // don't worry about previous display style

    element.appendChild(n);
    element.style.display = 'none';

    setTimeout(function(){
        element.style.display = disp;
        n.parentNode.removeChild(n);
    },20); // you can play with this timeout to make it as short as possible
}
</script>

<script>


	Core9.multiImport([ 'app/elements/core9-file/js/file' ])
			.then(
					function(modules) {

						var FILE = Core9.unwrapModule(modules[0]);

						Polymer({
							is : 'core9-filemanager',
							ready : function() {

							var that = this;


								$.ajax({
								    url: 'http://192.168.1.71:8080/testdb/mybucket.files/?page=1&pagesize=200',
								    type: 'GET',
								    dataType: 'json',
								    beforeSend: function (xhr) {
								        xhr.setRequestHeader("Authorization", "Basic "
						                          + Base64.encode("admin" + ":" + "changeit"));
								    }
								}).complete(function (result) {

					                 that.checksOrg = [
		                                            {first: 'Bob', last: 'Smith'},
		                                            {first: 'Sally', last: 'Johnson'}
		                                        ];


									console.log(JSON.parse(result.responseText));

									var res = JSON.parse(result.responseText);

									var files = res._embedded['rh:file'];
									for (var i = 0; i < files.length; i++) {
									    console.log(files[i]);
									    that.checksOrg.push({first: files[i].filename, last: files[i]._lastupdated_on});
									}


									that.checks = that.checksOrg;


								}).fail(function (result) {
									console.log(result);
								});


								var table2 = this.$.table2;
								var statusFilter = this.$.filterstatus;
								var filter = this.$.filter;

								$(table2)
										.footable({
											breakpoints : {
												tiny : 100,
												medium : 555,
												big : 2048
											}
										})
										.bind(
												'footable_filtering',
												function(e) {

													var selected = $(
															statusFilter).find(
															':selected').text();
													if (selected
															&& selected.length > 0) {
														e.filter += (e.filter && e.filter.length > 0) ? ' '
																+ selected
																: selected;
														e.clear = !e.filter;
													}

												});

								$(statusFilter).change(function(e) {
									e.preventDefault();
									$(table2).trigger('footable_filter', {
										filter : $(statusFilter).val()
									});
								});

								$(filter).on('input', function() {
									$(table2).trigger('footable_filter', {
										filter : $(this).val()
									});
								});

			                      try {
			                          setTimeout(function(){
			                        	   console.log("running timer");
			                        	   var sort = $('.footable-sort-indicator');
			                        	   console.log(sort);
			                        	   $(sort[0]).trigger('click');
			                        	  }, 100);
			                      } catch (e) {
			                        // TODO: handle exception
			                      }

							}
						});

					})
</script>