<dom-module id="core9-filemanager">

  <link rel="import" type="css" href="../../../bower_components/footable/css/footable.core.min.css">
  <link rel="import" type="css" href="../../../bower_components/footable/css/footable.metro.min.css">
  <!-- <link rel="import" type="css" href="../../../bower_components/materialize/dist/css/materialize.min.css"> -->
  <link rel="import" type="css" href="core9-filemanager.css">

  <script src="../../../bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
  <script src="../../../bower_components/footable/dist/footable.all.min.js" type="text/javascript"></script>
  <script src="../../../bower_components/footable/dist/footable.filter.min.js" type="text/javascript"></script>
  <!-- <script	src="../../../bower_components/materialize/dist/js/materialize.min.js"></script> -->

  <template>

    <core9-filedrop> </core9-filedrop>


    <div class="input-field col s5">
      <input id="filter" type="text" />
      <label>Search:</label>
    </div>
    <div class="input-field col s5">
      <select id="filterstatus" class="filter-status">
        <option></option>
        <option value="active">Active</option>
        <option value="disabled">Disabled</option>
        <option value="suspended">Suspended</option>
      </select>
      <label>Status:</label>
    </div>
    <script>
      $(document).ready(function() {
        //$('select').material_select();
      });
    </script>

    <br />
    <br />

    <table id="table2" class="table" data-filter="#filter" data-filter-minimum="3" data-filter-timeout="500" data-filter-text-only="true" data-page-size="5">
      <thead>
        <tr>
          <th>First Name</th>
          <th>Last Name</th>
          <th data-hide="phone,tablet">Job Title</th>
          <th data-hide="phone,tablet">DOB</th>
          <th data-hide="phone">Status</th>
          <th data-hide="phone">Delete</th>
        </tr>
      </thead>
      <tbody>
        <template is="dom-repeat" items="{{checks}}">
          <tr>
            <td>{{item.first}}</td>
            <td><a href="#">{{item.last}}</a></td>
            <td>Traffic Court Referee</td>
            <td data-value="78025368997">22 Jun 1972</td>
            <td data-value="1">
              <span class="status-metro status-active" title="Active">Active</span>
            </td>
            <td>
              <a class="row-delete" href="#">
                <span class="glyphicon glyphicon-remove">x</span>
              </a>
            </td>
          </tr>
        </template>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="6">
            <div class="pagination pagination-centered"></div>
          </td>
        </tr>
      </tfoot>
    </table>


    <content></content>
  </template>
</dom-module>



<script>
  Polymer({
    is: 'core9-filemanager',
    ready: function() {

      var that = this;

      $
        .ajax({
          url: 'http://127.0.0.1:8080/testdb/mybucket.files/?page=1&pagesize=200',
          type: 'GET',
          dataType: 'json',
          beforeSend: function(xhr) {
            xhr
              .setRequestHeader(
                "Authorization",
                "Basic " + btoa("admin" + ":" + "changeit"));
          }
        }).complete(function(result) {

          that.checksOrg = [{
            first: 'Bob',
            last: 'Smith'
          }, {
            first: 'Sally',
            last: 'Johnson'
          }];

          try {
            var res = JSON.parse(result.responseText);

            var files = res._embedded['rh:file'];
            if (typeof files !== 'undefined') {
              for (var i = 0; i < files.length; i++) {
                that.checksOrg.push({
                  first: files[i].filename,
                  last: files[i]._lastupdated_on
                });
              }
            }

            that.checks = that.checksOrg;
          } catch (e) {

          }



        }).fail(function(result) {
          //console.log(result);
        });

      var table2 = this.$.table2;
      var statusFilter = this.$.filterstatus;
      var filter = this.$.filter;

      $(table2)
        .footable({
          breakpoints: {
            tiny: 100,
            medium: 555,
            big: 2048
          }
        })
        .bind(
          'footable_filtering',
          function(e) {

            var selected = $(statusFilter)
              .find(':selected').text();
            if (selected && selected.length > 0) {
              e.filter += (e.filter && e.filter.length > 0) ? ' ' + selected : selected;
              e.clear = !e.filter;
            }

          });

      $(statusFilter).change(function(e) {
        e.preventDefault();
        $(table2).trigger('footable_filter', {
          filter: $(statusFilter).val()
        });
      });

      $(filter).on('input', function() {
        $(table2).trigger('footable_filter', {
          filter: $(this).val()
        });
      });

      try {
        setTimeout(function() {
          //console.log("running timer");
          var sort = $('.footable-sort-indicator');
          //console.log(sort);
          $(sort[0]).trigger('click');
        }, 100);
      } catch (e) {
        // TODO: handle exception
      }

    }
  });
</script>
