<!DOCTYPE html>
<!--[if lt IE 7]>
<html lang="en" class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html lang="en" class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html lang="en" class="lt-ie9"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, minimum-scale=1">
<title>Nestable</title>
<link rel="stylesheet"
	href="/dashboard/bower_components/select2/dist/css/select2.min.css">
<link rel="stylesheet"
	href="/dashboard/bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="/dashboard/bower_components/nestable2/jquery.nestable.css">
<style type="text/css">
/**
 * Nestable Extras
 */
@media only screen and (min-width: 700px) {
	.dd {
		float: left;
		width: 48%;
	}
	.dd+.dd {
		margin-left: 2%;
	}
}

.dd-hover>.dd-handle {
	background: #f5f5f5 !important;
}

.dd-handle {
	padding-left: 20px;
}
/**
 * Nestable Draggable Handles
 */
.dd-content {
	padding-left: 30px;
}

.dd-item>button {
	left: 30px;
	margin-right: -5px;
}

.dd3-content {
	display: block;
	height: 30px;
	margin: 5px 0;
	margin-left: 15px;
	padding: 5px 10px 5px 40px;
	color: #333;
	text-decoration: none;
	font-weight: bold;
	border: 1px solid #ccc;
	background: #f5f5f5 !important;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}

.dd3-content:hover {
	color: #2ea8e5;
	background: #fff;
}

.dd-dragel>.dd3-item>.dd3-content {
	margin: 0;
}

.dd3-item>button {
	margin-left: 30px;
}

.dd3-handle {
	position: absolute;
	margin: 0;
	left: 0;
	top: 0;
	cursor: pointer;
	width: 30px;
	text-indent: 100%;
	white-space: nowrap;
	overflow: hidden;
	border: 1px solid #aaa;
	background: #ddd;
	background: -webkit-linear-gradient(top, #ddd 0%, #bbb 100%);
	background: -moz-linear-gradient(top, #ddd 0%, #bbb 100%);
	background: linear-gradient(top, #ddd 0%, #bbb 100%);
	border-top-right-radius: 0;
	border-bottom-right-radius: 0;
}

.dd3-handle:before {
	content: 'â‰¡';
	display: block;
	position: absolute;
	left: 0;
	top: 3px;
	width: 100%;
	text-align: center;
	text-indent: 0;
	color: #fff;
	font-size: 20px;
	font-weight: normal;
}

.dd3-handle:hover {
	background: #ddd;
}

/** table example **/

/** content **/
#content {
	width: calc(100% - 450px);
	margin-left: 300px;
	position: relative;
}

#nestable {
	margin-right: 50px;
	width: 500px;
}

#menuitemcontent {
	background-color: #fff;
	position: absolute;
	width: calc(100% - 550px);
	min-height: 500px;
	left: 550px;
	  top: 73px;
}

/** select2 **/

.select2-container, .form-group > .select2-container--default {
	width:100% !important;
}

#navlist {
  margin-left: -40px;
  margin-top: 20px;
}

#navlist li
{
_display: inline;
display:inline-block;
list-style-type: none;
padding-right: 20px;

}

.table>tbody>tr>td {
	padding:5px;
}


</style>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="/dashboard/bower_components/nestable2/jquery.nestable.js"></script>
<script
	src="/dashboard/bower_components/select2/dist/js/select2.full.min.js"></script>
<script
	src="/dashboard/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script
	src="/dashboard/bower_components/json-editor/dist/jsoneditor.min.js"></script>
</head>
<body>



	<div id="content" class="cf nestable-lists">

		<div style="width: 100%;" class="btn-group" role="group" aria-label="" style="width: 500px; left: 195px; top: -34px;">
			
			<ul id="navlist">
				<li style="width: 300px !important; height: 40px;">
					<select class="js-example-data-array"></select> 
				</li>
				<li style="width: 98px !important; height: 40px;">
					<select	class="js-example-data-array"></select>
				</li>
				<li style="width: 98px !important; height: 40px;">
					<select class="js-example-data-array"></select>
				</li>
				<li style="width: 300px !important; height: 40px;  padding-left: 42px;">
					<select class="js-example-data-array"></select>
				</li>
			</ul>
			
			
		</div>

		<div class="dd" id="nestable"></div>

		<div id="menuitemcontent">
			<div class="btn-group" role="group" aria-label=""
				style="width: 500px;">
				<button type="button" class="btn btn-default">Preview</button>
				<button type="button" class="btn btn-default">Edit</button>
				<button type="button" class="btn btn-default">Delete</button>
			</div>

			<div id='editor_holder' style="margin-top: 10px;"></div>
			<button id='submiteditor'>Save</button>
			<div id='version_holder' style="margin-top: 10px;"></div>
			<button id='submitversions'>Save</button>
			
		</div>


	</div>


	<script>
	
	Core9 = {};
	Core9.editor = {};
	Core9.editor2 = {};
	
	
	var activateEditor = function(page){
	try {
		Core9.editor.destroy();
		Core9.editor2.destroy();
	} catch (e) {
		// TODO: handle exception
	}

	var getArray =function(nr){
		return	Array.apply(null, {length: nr}).map(Number.call, Number)
	}
		
		
   	Core9.editor = new JSONEditor(document.getElementById('version_holder'),{
	    	disable_edit_json : true,
	    	disable_collapse : true,
	    	disable_properties : true,
	    	format : 'grid',
	    	theme: 'bootstrap3',
	        schema: {
	          type: "object",
	          title: page,
	          properties: {
	          "versions": {
	        	        "type": "array",
	        	        "format": "table",
	        	        "title": "Versions",
	        	        "uniqueItems": true,
	        	        "items": {
	        	          "type": "object",
	        	          "title": "Version",
	        	          "properties": {
	        	            "type": {
	        	              "type": "integer",
	        	              "enum": getArray(100),
	        	              "default": 0
	        	            },
	        	            "name": {
	        	              "type": "string"
	        	            },
	        	            "status": {
		        	              "type": "string",
		        	              "enum": ["active","pause"],
		        	              "default": "active"
		        	        }
	        	          }
	        	        },
	        	        "default": [
	        	          {
	        	            "type": 0,
	        	            "name": "Walter",
	        	            "status":"active"
	        	          }
	        	        ]
	        	      }
	          }
	        }
	      });
	      
   	
   	Core9.editor2 = new JSONEditor(document.getElementById('editor_holder'),{
    	disable_edit_json : true,
    	disable_collapse : true,
    	disable_properties : true,
    	format : 'grid',
    	theme: 'bootstrap3',
        schema: {
          type: "object",
          title: page,
          properties: {
            template: {
              type: "string",
              enum: [
                "Toyota",
                "BMW",
                "Honda",
                "Ford",
                "Chevy",
                "VW"
              ]
            },
            title: {
              type: "string"
            },
            url: {
                type: "string"
              }
          }
        }
      });
      
   	
   	
	      // Hook up the submit button to log to the console
	      document.getElementById('submiteditor').addEventListener('click',function() {
	        // Get the value from the editor
	        console.log(Core9.editor2.getValue());
	      });
	      document.getElementById('submitversions').addEventListener('click',function() {
		        // Get the value from the editor
		        console.log(Core9.editor.getValue());
		      });
	
	}
	

    $(document).ready(function() {
    	



  
        
        var updateOutput = function(){
        	var content = $('#nestable').nestable('serialize');
			console.log(content);
			console.log(JSON.stringify(content));
        }
        
        var jsonStr = '[{"page":"Second item","id":2,"children":[{"page":"Item 3","id":3,"children":[{"page":"Item 4","id":4,"children":[{"foo":"Bar","value":"Item 5 value","page":"Item 5","id":5,"children":[{"page":"Item 6","id":6,"children":[{"page":"Item 7","id":7,"children":[{"page":"Item 8","id":8,"children":[{"page":"First item","id":1}]}]}]}]}]}]}]},{"page":"Item 9","id":9,"children":[{"page":"Item 10","id":10,"children":[{"page":"Item 11","id":11,"children":[{"page":"Item 12","id":12}]}]}]}]';
        
        
        
        function process(key,value,dropdownList) {
            if(key == 'page'){
            	if(!dropdownList.indexOf(value) > -1){
            		dropdownList.push(value);
            	}
            }
        }

        function traverse(o,func,dropdownList) {
            for (var i in o) {
                func.apply(this,[i,o[i],dropdownList]);  
                if (o[i] !== null && typeof(o[i])=="object") {
                    traverse(o[i],func,dropdownList);
                }
            }
        }


        
        
        var makeDropDownFromJsonString = function(jsonStr){
        	var dropdownList = [];
        	var json = JSON.parse(jsonStr);
            traverse(json,process,dropdownList);
            return dropdownList;
        	
        }
        var selectList = makeDropDownFromJsonString(jsonStr);
        
        
	 
		$(".js-example-data-array").select2({
		  data: selectList
		})
        

        $('#nestable').nestable({
            group: 1,
            maxDepth:20,
            json: jsonStr,
            contentCallback: function(item) {
                var content = item.page || '' ? item.page : item.id;
                content += '<div class="dd-handle dd3-handle">Drag</div>';

                return content;
            },
            callback: function(l,e){
                //console.log(l);
                var page = $(e[0]).find('.dd-content')[0].childNodes[0].textContent;
                
                activateEditor(page);
                
            }
        }).on('change', updateOutput);
    	
        

        
    });
</script>
</body>
</html>
